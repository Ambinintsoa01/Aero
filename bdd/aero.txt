
CREATE TABLE Aeroports (
    code_iata VARCHAR(3) PRIMARY KEY, 
    nom VARCHAR(100) NOT NULL,
    ville VARCHAR(100) NOT NULL,
    pays VARCHAR(100) NOT NULL,
    fuseau_horaire VARCHAR(50) NOT NULL 
);


CREATE TABLE Statut_Avion (
    statut_id SERIAL PRIMARY KEY,
    statut_nom VARCHAR(20) UNIQUE NOT NULL 
);

CREATE TABLE Avions (
    avion_id SERIAL PRIMARY KEY,
    immatriculation VARCHAR(10) UNIQUE NOT NULL, 
    modele VARCHAR(50) NOT NULL, 
    capacite_eco INT NOT NULL,
    capacite_business INT NOT NULL,
    date_dernier_entretien DATE,
    statut INT REFERENCES Statut_Avion(statut_id) 
);


CREATE TABLE Vols (
    vol_id SERIAL PRIMARY KEY,
    numero_vol VARCHAR(10) UNIQUE NOT NULL,
    description TEXT
);


CREATE TABLE Segments_Vol (
    segment_id SERIAL PRIMARY KEY,
    vol_id INT REFERENCES Vols(vol_id) ON DELETE CASCADE,
    aeroport_depart VARCHAR(3) REFERENCES Aeroports(code_iata),
    aeroport_arrivee VARCHAR(3) REFERENCES Aeroports(code_iata),
    ordre_segment INT NOT NULL, 
    heure_depart_UTC TIME NOT NULL,
    heure_arrivee_UTC TIME NOT NULL,
    jour_de_semaine INT 
);

CREATE TABLE Instances_Vols (
    instance_id SERIAL PRIMARY KEY,
    segment_id INT REFERENCES Segments_Vol(segment_id),
    avion_id INT REFERENCES Avions(avion_id),
    date_depart_reelle DATE NOT NULL,
    etat_vol INT DEFAULT 1, 
    prix_base DECIMAL(10,2) 
);

CREATE TABLE Role_employe (
    role_id SERIAL PRIMARY KEY,
    role_nom VARCHAR(20) UNIQUE NOT NULL
);

CREATE TABLE Employes (
    employe_id SERIAL PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    prenom VARCHAR(100) NOT NULL,
    role INT REFERENCES Role_employe(role_id),
    specialisation VARCHAR(50), 
    heures_vol_mois INT DEFAULT 0
);


CREATE TABLE Affectation_Equipage (
    instance_id INT REFERENCES Instances_Vols(instance_id),
    employe_id INT REFERENCES Employes(employe_id),
    PRIMARY KEY (instance_id, employe_id)
);

CREATE TABLE Passagers (
    passager_id SERIAL PRIMARY KEY,
    nom VARCHAR(100) NOT NULL,
    prenom VARCHAR(100) NOT NULL,
    num_passeport VARCHAR(20) UNIQUE NOT NULL,
    email VARCHAR(100)
);


CREATE TABLE Reservations (
    reservation_id SERIAL PRIMARY KEY,
    pnr VARCHAR(6) UNIQUE NOT NULL, 
    passager_id INT REFERENCES Passagers(passager_id),
    date_reservation TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    statut_paiement VARCHAR(20)
);

CREATE TABLE Paiements (
    paiement_id SERIAL PRIMARY KEY,
    reservation_id INT REFERENCES Reservations(reservation_id),
    montant DECIMAL(10,2) NOT NULL,
    date_paiement TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    methode_paiement VARCHAR(50) 
);


CREATE TABLE Class_Reservation (
    class_id SERIAL PRIMARY KEY,
    class_name VARCHAR(20) 
);

CREATE TABLE Detail_Reservation (
    reservation_id INT REFERENCES Reservations(reservation_id),
    instance_id INT REFERENCES Instances_Vols(instance_id),
    classe INT REFERENCES Class_Reservation(class_id), 
    siege_assigne VARCHAR(5),
    PRIMARY KEY (reservation_id, instance_id)
);